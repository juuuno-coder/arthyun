-- [스토리지 권한 해결 SQL]
-- Supabase SQL Editor에서 실행해주세요.

-- 1. storage.objects 테이블에 대한 RLS 활성화 (보통 되어있음)
alter table storage.objects enable row level security;

-- 2. og_images 버킷에 대한 권한 설정
-- 충돌 방지를 위해 기존 정책이 있다면 삭제 시도 (에러나면 무시해도 됨)
drop policy if exists "Allow authenticated uploads" on storage.objects;
drop policy if exists "Allow authenticated updates" on storage.objects;
drop policy if exists "Allow authenticated deletes" on storage.objects;
drop policy if exists "Public Access" on storage.objects;

-- 3. 새 정책 생성
-- (1) 업로드 허용: 로그인한 관리자(authenticated)만 'og_images' 버킷에 파일 업로드 가능
create policy "Allow authenticated uploads"
on storage.objects for insert
to authenticated
with check ( bucket_id = 'og_images' );

-- (2) 수정 허용
create policy "Allow authenticated updates"
on storage.objects for update
to authenticated
using ( bucket_id = 'og_images' );

-- (3) 삭제 허용
create policy "Allow authenticated deletes"
on storage.objects for delete
to authenticated
using ( bucket_id = 'og_images' );

-- (4) 조회(보기) 허용: 누구나(public) 볼 수 있음
create policy "Public Access"
on storage.objects for select
to public
using ( bucket_id = 'og_images' );
