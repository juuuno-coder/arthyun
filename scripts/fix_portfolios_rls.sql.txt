-- [Fix Portfolios RLS]
-- "new row violates row-level security policy for table portfolios" 오류 해결 스크립트
-- 이 스크립트를 Supabase 대시보드 또는 관리자 페이지의 SQL 에디터에서 실행하세요.

-- 1. 기존 정책 삭제 (충돌 방지)
DROP POLICY IF EXISTS "Enable read access for all users" ON public.portfolios;
DROP POLICY IF EXISTS "Enable insert for authenticated users only" ON public.portfolios;
DROP POLICY IF EXISTS "Enable update for authenticated users only" ON public.portfolios;
DROP POLICY IF EXISTS "Enable delete for authenticated users only" ON public.portfolios;
DROP POLICY IF EXISTS "Enable all access for all users" ON public.portfolios;

-- 2. RLS 활성화 확인
ALTER TABLE public.portfolios ENABLE ROW LEVEL SECURITY;

-- 3. 모든 사용자에게 CRUD(읽기/쓰기/수정/삭제) 권한 부여
-- 현재 클라이언트 코드에서 인증 세션을 전달하지 않는 방식(익명 접속)으로 구현되어 있어
-- 우선 모든 요청을 허용하도록 설정합니다. (추후 보안 강화 필요 시 변경 가능)
CREATE POLICY "Enable all access for all users"
ON public.portfolios
FOR ALL
USING (true)
WITH CHECK (true);

-- 확인 메시지 출력
SELECT 'Successfully updated RLS policies for portfolios table' as result;
